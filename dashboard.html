<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>employee Dashboard</title>
  <link rel="stylesheet" href="dashboard.css">
</head>
<body>
  <h1>Employee Dashboard</h1>
  <table id="studentsTable">
    <thead>
      <tr>
        <th>First Name</th>
        <th>Last Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Edit Student</h2>
      <form id="editForm">
        <input type="hidden" id="editId">
        <div class="form-group">
          <label for="editFirstName">First Name</label>
          <input type="text" id="editFirstName" required>
        </div>
        <div class="form-group">
          <label for="editLastName">Last Name</label>
          <input type="text" id="editLastName" required>
        </div>
        <div class="form-group">
          <label for="editEmail">Email</label>
          <input type="email" id="editEmail" required>
        </div>
        <div class="form-group">
          <label for="editPhone">Phone</label>
          <input type="text" id="editPhone" required>
        </div>
        <div class="form-group">
          <label for="editPassword">Password</label>
          <input type="password" id="editPassword" required>
        </div>
        <button type="submit" class="save-btn">Save Changes</button>
      </form>
    </div>
  </div>

  <script>
    // Fetch and display students
    async function fetchStudents() {
      try {
        const response = await fetch('/api/students');
        const students = await response.json();
        const tableBody = document.querySelector('#studentsTable tbody');
        tableBody.innerHTML = '';
        
        students.forEach(student => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${student.firstName}</td>
            <td>${student.lastName}</td>
            <td>${student.email}</td>
            <td>${student.phone}</td>
            <td class="action-btns">
              <button class="edit-btn" data-id="${student._id}">Edit</button>
              <button class="delete-btn" data-id="${student._id}">Delete</button>
            </td>
          `;
          tableBody.appendChild(row);
        });

        // Add event listeners to edit buttons
        document.querySelectorAll('.edit-btn').forEach(btn => {
          btn.addEventListener('click', openEditModal);
        });

        // Add event listeners to delete buttons
        document.querySelectorAll('.delete-btn').forEach(btn => {
          btn.addEventListener('click', deleteStudent);
        });
      } catch (error) {
        console.error('Error fetching students:', error);
      }
    }

    // Edit student modal
    const modal = document.getElementById('editModal');
    const closeBtn = document.querySelector('.close');
    let currentStudentId = null;

    function openEditModal(e) {
      currentStudentId = e.target.getAttribute('data-id');
      const row = e.target.closest('tr');
      const cells = row.querySelectorAll('td');
      
      document.getElementById('editId').value = currentStudentId;
      document.getElementById('editFirstName').value = cells[0].textContent;
      document.getElementById('editLastName').value = cells[1].textContent;
      document.getElementById('editEmail').value = cells[2].textContent;
      document.getElementById('editPhone').value = cells[3].textContent;
      
      modal.style.display = 'block';
    }

    closeBtn.onclick = function() {
      modal.style.display = 'none';
    }

    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = 'none';
      }
    }

    // Update student
    document.getElementById('editForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const updatedStudent = {
        firstName: document.getElementById('editFirstName').value,
        lastName: document.getElementById('editLastName').value,
        email1: document.getElementById('editEmail').value,
        phone: document.getElementById('editPhone').value,
        password: document.getElementById('editPassword').value
      };

      try {
        const response = await fetch(`/api/students/${currentStudentId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(updatedStudent)
        });

        if (response.ok) {
          modal.style.display = 'none';
          fetchStudents(); // Refresh the table
        } else {
          console.error('Failed to update student');
        }
      } catch (error) {
        console.error('Error updating student:', error);
      }
    });

    // Delete student
    async function deleteStudent(e) {
      if (!confirm('Are you sure you want to delete this student?')) return;
      
      const studentId = e.target.getAttribute('data-id');
      
      try {
        const response = await fetch(`/api/students/${studentId}`, {
          method: 'DELETE'
        });

        if (response.ok) {
          fetchStudents(); // Refresh the table
        } else {
          console.error('Failed to delete student');
        }
      } catch (error) {
        console.error('Error deleting student:', error);
      }
    }

    // Initial load
    fetchStudents();
  </script>
</body>
</html>